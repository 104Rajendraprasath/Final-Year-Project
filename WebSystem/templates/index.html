    <!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Surveillance Control Center</title>
    <style>
        /* Dark Theme Styling */
        body {
            background-color: #0d1117;
            color: #e6edf3;
            font-family: 'Segoe UI', monospace;
            margin: 0;
            padding: 20px;
        }

        h1 {
            text-align: center;
            color: #58a6ff;
            text-transform: uppercase;
            letter-spacing: 2px;
            border-bottom: 1px solid #30363d;
            padding-bottom: 20px;
        }

        /* Grid Layout for 5 Cameras */
        .camera-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        /* Individual Camera Card Styling */
        .camera-card {
            background: #161b22;
            border: 2px solid #30363d;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .camera-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            font-size: 1.1em;
            font-weight: bold;
            color: #8b949e;
        }

        .location-tag {
            font-size: 0.8em;
            color: #58a6ff;
        }

        /* The "Screen" that shows status or video */
        .camera-screen {
            width: 100%;
            height: 180px;
            background-color: #000;
            border: 1px solid #30363d;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            margin-bottom: 15px;
            position: relative;
            overflow: hidden;
        }

        .camera-icon {
            font-size: 40px;
            margin-bottom: 10px;
            opacity: 0.5;
        }

        /* Status Badges */
        .status-badge {
            padding: 8px 15px;
            border-radius: 4px;
            font-weight: bold;
            text-transform: uppercase;
            display: block;
        }

        .status-idle { background-color: #21262d; color: #8b949e; border: 1px solid #30363d; }
        .status-loading { background-color: #9e6a03; color: white; animation: pulse 1.5s infinite; }
        .status-safe { background-color: #1f6feb; color: white; box-shadow: 0 0 10px #1f6feb; }
        .status-alert { background-color: #da3633; color: white; box-shadow: 0 0 15px #da3633; animation: flash 1s infinite; }

        /* The Hidden File Input */
        input[type="file"] {
            display: none;
        }

        /* Simulation Button */
        .btn-simulate {
            background-color: #238636;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-family: inherit;
            width: 100%;
            font-size: 0.9em;
        }
        .btn-simulate:hover { background-color: #2ea043; }

        /* Animations */
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.6; } 100% { opacity: 1; } }
        @keyframes flash { 0% { border-color: #da3633; } 50% { border-color: transparent; } 100% { border-color: #da3633; } }

    </style>
</head>
<body>

    <h1>üëÅÔ∏è Central Surveillance Command</h1>

    <div class="camera-grid">
        <!-- Jinja2 Loop to generate cameras from Python Dictionary -->
        {% for key, cam in cameras.items() %}
        <div class="camera-card" id="card-{{ key }}">
            <div class="camera-header">
                <span>CAM {{ cam.id }}</span>
                <span class="location-tag">üìç {{ cam.location }}</span>
            </div>

            <div class="camera-screen" id="screen-{{ key }}">
                <div class="camera-icon">üì∑</div>
                <div style="color: #444;">No Signal Input</div>
            </div>

            <!-- Status Display -->
            <div id="status-{{ key }}" class="status-badge status-idle">System Idle</div>

            <br>

            <!-- Interaction Elements -->
            <!-- 1. The button triggers the hidden input -->
            <button class="btn-simulate" onclick="document.getElementById('input-{{ key }}').click()">
                üìÇ Load Video Feed
            </button>

            <!-- 2. Hidden File Input -->
            <input type="file" id="input-{{ key }}" accept="video/*" onchange="uploadVideo('{{ key }}')">
        </div>
        {% endfor %}
    </div>

    <script>
        // Function called when a file is selected
        function uploadVideo(camKey) {
            const input = document.getElementById(`input-${camKey}`);
            const statusDiv = document.getElementById(`status-${camKey}`);
            const cardDiv = document.getElementById(`card-${camKey}`);
            const screenDiv = document.getElementById(`screen-${camKey}`);

            // Ensure a file was actually selected
            if (input.files && input.files[0]) {
                const file = input.files[0];

                // 1. Update UI to "Processing" state
                statusDiv.innerText = "Analyzing Stream...";
                statusDiv.className = "status-badge status-loading";
                screenDiv.innerHTML = `<div class="camera-icon">‚öôÔ∏è</div><div style="color: yellow;">Processing AI Model...</div>`;

                // 2. Prepare Data for Backend
                const formData = new FormData();
                formData.append('video', file);
                formData.append('camera_id', camKey);

                console.log(`[Frontend] Sending video from ${camKey} to backend...`);

                // 3. Send to Flask Backend API
                fetch('/process_feed', {
                    method: 'POST',
                    body: formData
                })
                .then(response => response.json())
                .then(data => {
                    // --- RESULT RECEIVED ---
                    
                    // 4. Log Result to Console (As requested)
                    console.log(">>> AI ANALYSIS RESULT RECEIVED <<<");
                    console.log("Camera ID:", data.camera_id);
                    console.log("Location:", data.location);
                    console.log("Status:", data.status);
                    console.log("Confidence:", data.confidence);
                    console.log("Full Response:", data);

                    // 5. Update UI based on Result
                    if (data.status === "ALERT") {
                        // Violence Detected
                        statusDiv.innerText = `üö® VIOLENCE DETECTED (${data.confidence})`;
                        statusDiv.className = "status-badge status-alert";
                        cardDiv.style.borderColor = "#da3633";
                        screenDiv.innerHTML = `<div style="font-size:50px">‚ö†Ô∏è</div><div style="color:red; font-weight:bold">THREAT DETECTED</div>`;
                    } else {
                        // Non-Violence
                        statusDiv.innerText = "‚úÖ Area Safe";
                        statusDiv.className = "status-badge status-safe";
                        cardDiv.style.borderColor = "#1f6feb";
                        screenDiv.innerHTML = `<div style="font-size:50px">üõ°Ô∏è</div><div style="color:#1f6feb; font-weight:bold">Monitoring Active</div>`;
                    }
                })
                .catch(error => {
                    console.error("Error communicating with backend:", error);
                    statusDiv.innerText = "Connection Error";
                    statusDiv.className = "status-badge status-idle";
                });
            }
        }
    </script>
</body>
</html>